#!/usr/bin/with-contenv bashio
set -e

bashio::log.info "s6-overlay service 'my_todo_app' is starting Node.js backend..."

export PORT=$(bashio::config 'port_internal' || echo 3000)
export DATABASE_PATH="/data/todo.db"

mkdir -p "$(dirname "${DATABASE_PATH}")"
bashio::log.info "Database path: ${DATABASE_PATH}"
bashio::log.info "Server will listen on port: ${PORT}"

# No `exec`, just start the process (s6-overlay will supervise it)
echo "[INFO] Starting Node.js backend..."
exec node /app/server.js
